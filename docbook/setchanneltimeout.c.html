<?xml version='1.0' encoding='iso-8859-1'?>
<!doctype html public '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
<html xmlns='http://www.w3c.org/1999/xhtml' lang='en-us'>
	<head>
		<title>
			setchanneltimeout.c
			</title>
		<meta http-equiv='content-type' content='text/html;iso-8859-1'/>
		<meta name='generator' content='Motley Tools 1.8.2'/>
		<meta name='author' content='cmaier@cmassoc.net'/>
		<meta name='robots' content='noindex,nofollow'/>
		<link href='toolkit.css' rel='stylesheet' type='text/css'/>
		</head>
	<body>
		<div class='headerlink'>
			[<a href='set32bitmap.c.html' title=' set32bitmap.c '>PREV</a>]
			[<a href='toolkit.html' title=' Index '>HOME</a>]
			[<a href='setpib.c.html' title=' setpib.c '>NEXT</a>]
			</div>
<pre>
/*====================================================================*
 *
 *   signed setchanneltimeout (struct channel * channel, unsigned timeout);
 *
 *   channel.h
 *   
 *   set the current channel timeout;   
 *
 *   This software and documentation is the property of Atheros 
 *   Corporation, Ocala, Florida. It is provided 'as is' without 
 *   expressed or implied warranty of any kind to anyone for any 
 *   reason. Atheros assumes no responsibility or liability for 
 *   errors or omissions in the software or documentation and 
 *   reserves the right to make changes without notification. 
 *   
 *   Atheros customers may modify and distribute the software 
 *   without obligation to Atheros. Since use of this software 
 *   is optional, users shall bear sole responsibility and 
 *   liability for any consequences of it's use. 
 *   
 *.  Qualcomm Atheros HomePlug AV Powerline Toolkit
 *:  Published 2009-2011 by Qualcomm Atheros. ALL RIGHTS RESERVED
 *;  For demonstration and evaluation only. Not for production use
 *
 *   Contributor(s):
 *	Nathaniel Houghton &lt;nathaniel.houghton@qualcomm.com&gt;
 *	Charles Maier &lt;cmaier@qualcomm.com&gt;
 *
 *--------------------------------------------------------------------*/

#ifndef SETCHANNELTIMEOUT_SOURCE
#define SETCHANNELTIMEOUT_SOURCE

#include &lt;unistd.h&gt;

#if defined (__APPLE__) || defined (__OpenBSD__)
#	include &lt;sys/ioctl.h&gt;
#endif

#include &quot;../ether/channel.h&quot;
#include &quot;../tools/error.h&quot;

#ifdef WIN32
#	if !defined(HAVE_VSNPRINTF)
#		undef vsnprintf
#	endif
#	if !defined(HAVE_SNPRINTF)
#		undef snprintf
#	endif
#	include &lt;pcap-int.h&gt;
#	include &lt;Packet32.h&gt;
#endif

signed setchanneltimeout (struct channel * channel, unsigned timeout) 

{
	channel-&gt;timeout = timeout;

#if defined (__linux__)

#elif defined (__APPLE__) || defined (__OpenBSD__)

	struct timeval timeval = 
	{
		0,
		0
	};
	if (channel-&gt;timeout &gt; 1000) 
	{
		timeval.tv_sec = channel-&gt;timeout / 1000;
		timeval.tv_usec = 0;
	}
	else 
	{

#if defined (__MAC_10_6) 

/*
 *	accommodate known bug in BPF on MAC OS X 10.6; shorter times cause socket read
 *	operations to block indefinitely if no frames are waiting because tv_usec gets
 *      clobbered;
 */

		timeval.tv_sec = 1;
		timeval.tv_usec = 0;

#else

		timeval.tv_sec = 0;
		timeval.tv_usec = channel-&gt;timeout * 1000;

#endif

	}
	if (ioctl (channel-&gt;fd, BIOCSRTIMEOUT, &amp;timeval) == -1) 
	{
		error (1, errno, &quot;%s&quot;, channel-&gt;ifname);
	}

#elif defined (WINPCAP) || defined (LIBPCAP)

	PacketSetReadTimeout (channel-&gt;socket-&gt;adapter, channel-&gt;timeout);

#else
#error &quot;Unknown Environment&quot;
#endif

	return (0);
}

#endif


</pre>
		<div class='footerlink'>
			[<a href='set32bitmap.c.html' title=' set32bitmap.c '>PREV</a>]
			[<a href='toolkit.html' title=' Index '>HOME</a>]
			[<a href='setpib.c.html' title=' setpib.c '>NEXT</a>]
			</div>
		</body>
	</html>
